<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Production Pipeline</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 18px;
      opacity: 0.9;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .form-group {
      margin-bottom: 24px;
    }

    label {
      display: block;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
      font-size: 14px;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.2s;
      font-family: inherit;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    button {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .result {
      margin-top: 30px;
      padding: 20px;
      border-radius: 8px;
      display: none;
    }

    .result.success {
      background: #d1fae5;
      border: 2px solid #10b981;
      color: #065f46;
    }

    .result.error {
      background: #fee2e2;
      border: 2px solid #ef4444;
      color: #991b1b;
    }

    .result h3 {
      margin-bottom: 12px;
      font-size: 18px;
    }

    .result pre {
      background: rgba(0, 0, 0, 0.05);
      padding: 12px;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 13px;
      line-height: 1.5;
    }

    .loading {
      display: none;
      text-align: center;
      margin-top: 20px;
    }

    .spinner {
      border: 4px solid #e5e7eb;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 12px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .api-link {
      text-align: center;
      margin-top: 20px;
      color: white;
      font-size: 14px;
    }

    .api-link a {
      color: white;
      text-decoration: underline;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }

    .action-buttons button {
      flex: 1;
      padding: 12px;
      font-size: 16px;
    }

    .btn-secondary {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .btn-tertiary {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }

    .instructions {
      background: #f3f4f6;
      padding: 16px;
      border-radius: 8px;
      margin-top: 16px;
      font-size: 14px;
      line-height: 1.6;
    }

    .instructions h4 {
      margin-bottom: 8px;
      color: #374151;
    }

    .instructions ol {
      margin-left: 20px;
      color: #6b7280;
    }

    .instructions code {
      background: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üé¨ Video Production Pipeline</h1>
      <p>Generate professional videos with AI in seconds</p>
    </div>

    <div class="card">
      <form id="videoForm">
        <div class="form-group">
          <label for="topic">Video Topic *</label>
          <input
            type="text"
            id="topic"
            name="topic"
            placeholder="e.g., AI tips for developers"
            required
          >
        </div>

        <div class="row">
          <div class="form-group">
            <label for="duration">Duration (seconds) *</label>
            <input
              type="number"
              id="duration"
              name="duration"
              value="30"
              min="15"
              max="120"
              required
            >
          </div>

          <div class="form-group">
            <label for="platform">Platform *</label>
            <select id="platform" name="platform" required>
              <option value="youtube-shorts">YouTube Shorts</option>
              <option value="instagram-reels">Instagram Reels</option>
              <option value="tiktok">TikTok</option>
              <option value="youtube">YouTube</option>
              <option value="linkedin">LinkedIn</option>
              <option value="twitter">Twitter/X</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            <label for="style">Style</label>
            <select id="style" name="style">
              <option value="modern">Modern</option>
              <option value="energetic">Energetic</option>
              <option value="corporate">Corporate</option>
              <option value="minimal">Minimal</option>
              <option value="playful">Playful</option>
              <option value="elegant">Elegant</option>
            </select>
          </div>

          <div class="form-group">
            <label for="tone">Tone</label>
            <select id="tone" name="tone">
              <option value="professional">Professional</option>
              <option value="casual">Casual</option>
              <option value="energetic">Energetic</option>
              <option value="educational">Educational</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="brandName">Brand Name (optional)</label>
          <input
            type="text"
            id="brandName"
            name="brandName"
            placeholder="Your Brand"
          >
        </div>

        <details style="margin-bottom: 24px;">
          <summary style="cursor: pointer; font-weight: 600; padding: 12px 0; color: #374151;">
            üé® Advanced Brand Customization
          </summary>

          <div class="form-group" style="margin-top: 16px;">
            <label for="logoUrl">Logo URL</label>
            <input
              type="url"
              id="logoUrl"
              name="logoUrl"
              placeholder="https://example.com/logo.png"
            >
            <small style="color: #6b7280; display: block; margin-top: 4px;">
              Upload your logo to Imgur, Cloudinary, or similar and paste the URL
            </small>
          </div>

          <div class="row">
            <div class="form-group">
              <label for="primaryColor">Primary Color</label>
              <div style="display: flex; gap: 8px;">
                <input
                  type="color"
                  id="primaryColor"
                  name="primaryColor"
                  value="#3B82F6"
                  style="width: 60px; height: 42px; padding: 4px;"
                >
                <input
                  type="text"
                  id="primaryColorText"
                  value="#3B82F6"
                  readonly
                  style="flex: 1;"
                >
              </div>
            </div>

            <div class="form-group">
              <label for="secondaryColor">Secondary Color</label>
              <div style="display: flex; gap: 8px;">
                <input
                  type="color"
                  id="secondaryColor"
                  name="secondaryColor"
                  value="#8B5CF6"
                  style="width: 60px; height: 42px; padding: 4px;"
                >
                <input
                  type="text"
                  id="secondaryColorText"
                  value="#8B5CF6"
                  readonly
                  style="flex: 1;"
                >
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="fontFamily">Font Family</label>
            <select id="fontFamily" name="fontFamily">
              <option value="Inter">Inter (Modern)</option>
              <option value="Poppins">Poppins (Friendly)</option>
              <option value="Roboto">Roboto (Clean)</option>
              <option value="Montserrat">Montserrat (Bold)</option>
              <option value="Open Sans">Open Sans (Classic)</option>
              <option value="Playfair Display">Playfair Display (Elegant)</option>
            </select>
          </div>

          <div class="form-group">
            <label>Brand Style Guide (PDF)</label>
            <input
              type="file"
              id="styleGuide"
              name="styleGuide"
              accept=".pdf"
              style="padding: 8px;"
            >
            <small style="color: #6b7280; display: block; margin-top: 4px;">
              Coming soon: Auto-extract colors and fonts from PDF
            </small>
          </div>
        </details>

        <button type="submit" id="submitBtn">
          Generate Video Specification
        </button>
      </form>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Generating your video specification...</p>
      </div>

      <div class="result" id="result"></div>
    </div>

    <div class="api-link">
      <a href="/api/index">API Documentation</a>
    </div>
  </div>

  <script>
    const form = document.getElementById('videoForm');
    const loading = document.getElementById('loading');
    const result = document.getElementById('result');
    const submitBtn = document.getElementById('submitBtn');

    // Sync color pickers with text inputs
    document.getElementById('primaryColor').addEventListener('input', (e) => {
      document.getElementById('primaryColorText').value = e.target.value.toUpperCase();
    });
    document.getElementById('secondaryColor').addEventListener('input', (e) => {
      document.getElementById('secondaryColorText').value = e.target.value.toUpperCase();
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Get form data
      const formData = new FormData(form);
      const data = Object.fromEntries(formData);

      // Prepare request payload
      const payload = {
        request: {
          topic: data.topic,
          duration: parseInt(data.duration),
          platform: data.platform,
          style: data.style,
          tone: data.tone,
        }
      };

      // Add branding if provided
      if (data.brandName || data.logoUrl || data.primaryColor || data.fontFamily) {
        payload.branding = {
          name: data.brandName || 'Your Brand',
          logo: data.logoUrl || undefined,
          colors: {
            primary: data.primaryColor || '#3B82F6',
            secondary: data.secondaryColor || '#8B5CF6',
            accent: '#EC4899',
            background: '#1F2937',
            text: '#F9FAFB',
          },
          fonts: {
            primary: data.fontFamily || 'Inter',
            secondary: 'Poppins',
          },
        };
      }

      // Show loading state
      submitBtn.disabled = true;
      loading.style.display = 'block';
      result.style.display = 'none';

      try {
        const response = await fetch('/api/generate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(payload),
        });

        const responseData = await response.json();

        if (response.ok) {
          // Store videoSpec for later use
          window.currentVideoSpec = responseData.videoSpec;

          result.className = 'result success';
          result.innerHTML = `
            <h3>‚úÖ Video Specification Generated!</h3>
            <p>${responseData.message}</p>

            <div class="action-buttons">
              <button class="btn-secondary" onclick="downloadSpec()">
                üì• Download JSON
              </button>
              <button class="btn-tertiary" onclick="renderWithLambda()" id="lambdaBtn">
                üöÄ Render with Lambda
              </button>
              <button class="btn-tertiary" onclick="showRenderInstructions()">
                ‚ÑπÔ∏è Local Render
              </button>
            </div>

            <div id="renderProgress" style="display: none; margin-top: 16px; padding: 12px; background: #eff6ff; border-radius: 8px;">
              <p style="margin: 0; color: #1e40af; font-weight: 600;">üé¨ Rendering video...</p>
              <div style="background: white; height: 8px; border-radius: 4px; margin-top: 8px; overflow: hidden;">
                <div id="progressBar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100%; width: 0%; transition: width 0.3s;"></div>
              </div>
              <p id="progressText" style="margin-top: 8px; font-size: 14px; color: #6b7280;">0% complete</p>
            </div>

            <div id="renderInstructions" class="instructions" style="display: none;">
              <h4>üé¨ Render Your Video</h4>
              <p><strong>Option 1: Local Rendering (Recommended)</strong></p>
              <ol>
                <li>Download the JSON spec above</li>
                <li>Clone the repo: <code>git clone https://github.com/joshacw/video-production-pipeline</code></li>
                <li>Install: <code>npm install</code></li>
                <li>Save your JSON spec to a file</li>
                <li>Start Remotion Studio: <code>npm run dev</code></li>
                <li>Load your spec in the studio and click "Render"</li>
              </ol>
              <p><strong>Option 2: Remotion Lambda (Cloud)</strong></p>
              <p>Deploy to AWS Lambda for scalable cloud rendering. See <a href="https://remotion.dev/docs/lambda" target="_blank">Remotion Lambda docs</a></p>
            </div>

            <details style="margin-top: 16px;">
              <summary style="cursor: pointer; font-weight: 600; padding: 8px 0;">View JSON Specification</summary>
              <pre>${JSON.stringify(responseData.videoSpec, null, 2)}</pre>
            </details>
          `;
        } else {
          throw new Error(responseData.error || 'Failed to generate video');
        }
      } catch (error) {
        result.className = 'result error';
        result.innerHTML = `
          <h3>‚ùå Error</h3>
          <p>${error.message}</p>
        `;
      } finally {
        submitBtn.disabled = false;
        loading.style.display = 'none';
        result.style.display = 'block';
      }
    });

    function downloadSpec() {
      if (!window.currentVideoSpec) {
        alert('No video specification available');
        return;
      }

      const dataStr = JSON.stringify(window.currentVideoSpec, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `video-spec-${window.currentVideoSpec.id || Date.now()}.json`;
      link.click();
      URL.revokeObjectURL(url);
    }

    function showRenderInstructions() {
      const instructions = document.getElementById('renderInstructions');
      if (instructions.style.display === 'none') {
        instructions.style.display = 'block';
      } else {
        instructions.style.display = 'none';
      }
    }

    async function renderWithLambda() {
      if (!window.currentVideoSpec) {
        alert('No video specification available');
        return;
      }

      const lambdaBtn = document.getElementById('lambdaBtn');
      const progressDiv = document.getElementById('renderProgress');
      const progressBar = document.getElementById('progressBar');
      const progressText = document.getElementById('progressText');

      lambdaBtn.disabled = true;
      lambdaBtn.textContent = 'üöÄ Starting render...';
      progressDiv.style.display = 'block';

      try {
        // Start render
        const startResponse = await fetch('/api/lambda-render', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            videoSpec: window.currentVideoSpec,
            composition: 'ExplainerVideo'
          }),
        });

        const startData = await startResponse.json();

        if (!startResponse.ok) {
          throw new Error(startData.error || 'Failed to start render');
        }

        // Poll for progress
        const { renderId, bucketName } = startData;
        let done = false;

        while (!done) {
          await new Promise(resolve => setTimeout(resolve, 3000)); // Poll every 3 seconds

          const progressResponse = await fetch(
            `/api/lambda-render?renderId=${renderId}&bucketName=${bucketName}`
          );
          const progressData = await progressResponse.json();

          if (progressData.success) {
            const progress = progressData.progress;
            const percent = Math.round(progress.overallProgress * 100);

            progressBar.style.width = percent + '%';
            progressText.textContent = `${percent}% complete (${progress.renderedFrames || 0}/${progress.totalFrames || 0} frames)`;

            if (progress.done && progress.outputFile) {
              done = true;
              progressDiv.innerHTML = `
                <p style="margin: 0; color: #059669; font-weight: 600;">‚úÖ Render complete!</p>
                <a href="${progress.outputFile}" target="_blank" style="display: inline-block; margin-top: 12px; padding: 10px 20px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">
                  üì• Download Video
                </a>
                <p style="margin-top: 12px; font-size: 14px; color: #6b7280;">Cost: $${progress.costs?.accruedSoFar?.toFixed(3) || '0.000'}</p>
              `;
              lambdaBtn.textContent = '‚úÖ Rendered!';
            }
          }
        }
      } catch (error) {
        progressDiv.innerHTML = `
          <p style="margin: 0; color: #dc2626; font-weight: 600;">‚ùå Render failed</p>
          <p style="margin-top: 8px; font-size: 14px; color: #6b7280;">${error.message}</p>
          ${error.message.includes('AWS credentials') ? `
            <p style="margin-top: 12px; font-size: 14px; color: #6b7280;">
              Configure AWS credentials in Vercel:
              <br>‚Ä¢ AWS_ACCESS_KEY_ID
              <br>‚Ä¢ AWS_SECRET_ACCESS_KEY
              <br>‚Ä¢ AWS_REGION
              <br>‚Ä¢ REMOTION_SITE_NAME
            </p>
          ` : ''}
        `;
        lambdaBtn.textContent = 'üöÄ Render with Lambda';
        lambdaBtn.disabled = false;
      }
    }
  </script>
</body>
</html>
